!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@onflow/config"),require("@onflow/types"),require("@onflow/fcl"),require("elliptic"),require("sha3")):"function"==typeof define&&define.amd?define(["exports","@onflow/config","@onflow/types","@onflow/fcl","elliptic","sha3"],n):n((t||self).flowCadut={},t.config,t.t,t.fcl,t.elliptic,t.sha3)}(this,function(t,n,r,e,o,c){function i(t){if(t&&t.i)return t;var n=Object.create(null);return t&&Object.keys(t).forEach(function(r){if("default"!==r){var e=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,e.get?e:{enumerable:!0,get:function(){return t[r]}})}}),n.default=t,n}var s=i(r),u=i(e);const a={emulator:{FungibleToken:"0xee82856bf20e2aa6",FlowFees:"0xe5a8b7f23e8b548f",FlowStorageFees:"0xf8d6e0586b0a20c7",FlowToken:"0x0ae53cb6e3f42a79"},testnet:{FungibleToken:"0x9a0766d93b6608b7",NonFungibleToken:"0x631e88ae7f1d7c20",FlowClusterQC:"0x9eca2b38b18b5dfe",FlowDKG:"0x9eca2b38b18b5dfe",FlowEpoch:"0x9eca2b38b18b5dfe",FlowIDTableStaking:"0x9eca2b38b18b5dfe",FlowToken:"0x7e60df042a9c0868",LockedTokens:"0x95e019a17d0e23d7",StakingProxy:"0x7aad92e5a0715d21",FlowStakingCollection:"0x95e019a17d0e23d7",FUSD:"0xe223d8a629e49c68"},mainnet:{FungibleToken:"0xf233dcee88fe0abe",NonFungibleToken:"0x1d7e57aa55817448",FlowClusterQC:"0x8624b52f9ddcd04a",FlowDKG:"0x8624b52f9ddcd04a",FlowEpoch:"0x8624b52f9ddcd04a",FlowIDTableStaking:"0x8624b52f9ddcd04a",FlowFees:"0xf919ee77447b7497",FlowToken:"0x1654653399040a61",LockedTokens:"0x8d0e87b65159ae63",StakingProxy:"0x62430cf28c26d095",FlowStakingCollection:"0x8d0e87b65159ae63",FUSD:"0x3c5959b568896393"}},f={emulator:{},testnet:{},mainnet:{}},l=t=>{for(const n of Object.keys(f)){const r=t[n],{name:e}=t;f[n]={...f[n],..."object"==typeof t[n]?r:{[e]:r}}}},d={mainnet:"https://access-mainnet-beta.onflow.org",testnet:"https://access-testnet.onflow.org",emulator:"http://localhost:8080"},m=function(){try{return Promise.resolve(function(){try{return Promise.resolve(n.config().get("ix.env")).then(function(t){return t||"emulator"})}catch(t){return Promise.reject(t)}}()).then(function(t){return{...a[t]||a.emulator,...f[t]||f.emulator}})}catch(t){return Promise.reject(t)}},h=t=>t.split(/\s/).map(t=>t.replace(/\s/g,"")).filter(t=>t.length>0&&"import"!==t&&"from"!==t),p=(t,n)=>{const[r,e]=n;return t[r]=e,t},g=t=>t&&0!==t.length?t.split("\n").filter(t=>/^\s*import\s+\w*\s+from/.test(t)).map(h).reduce(p,{}):{},P=(t,n={})=>{const r=g(t),e=[];for(const t in r)!n[t]&&Object.prototype.hasOwnProperty.call(r,t)&&e.push(t);return e},w=(t=[],n="")=>{const r="Missing imports for contracts:";console.error(n?`${n} ${r}`:r,t)},y=/(\s*import\s*)([\w\d]+)(\s+from\s*)([\w\d".\\/]+)/g,x=(t,n,r=!0)=>t.replace(y,(t,e,o,c,i)=>{const s=r?o:i;return`${e}${o} from ${(n instanceof Function?n(s):n[s])||i}`}),b=["public","private","storage"],v=t=>{const[n]=t.split("");return n.toUpperCase()+t.slice(1)},k=t=>{switch(!0){case t.indexOf("//")>=0:return"//";case t.indexOf("/")>=0:return"/";case t.indexOf("\\")>=0:return"\\";default:return""}},F=t=>t.replace(/\s+/g," "),$="contract",S="transaction",T="script",E=t=>t.split(",").map(t=>t.replace(/\s*/g,"")).filter(t=>""!==t),I=t=>t.replace(/(\/\*[\s\S]*?\*\/)|(\/\/.*)/g,""),N=t=>{let n=!1,r="";for(let e=0;e<t.length;e++)'"'===t[e]&&(n&&"\\"!==t[e-1]?(n=!1,r+=t[e]):n=!0),n||(r+=t[e]);return r},j=(t,n)=>{const r=I(t),e=F(r.replace(/[\n\r]/g,""));if(e){const t=new RegExp(n,"g").exec(e);if(t)return""===t[1]?[]:E(t[1])}return[]},C=t=>j(t,"(?:prepare\\s*\\(\\s*)([^\\)]*)(?:\\))"),A=t=>j(t,"(?:fun\\s+main\\s*\\(\\s*)([^\\)]*)(?:\\))"),B=t=>j(t,"(?:transaction\\s*\\(\\s*)([^\\)]*)(?:\\))"),q=t=>{const n=I(t).replace(/(resource|struct)\s+\w+\s*{[\s\S]+?}/g,""),r=/(?:access\(\w+\)|pub)\s+contract\s+(?:interface)*\s*(\w*)(\s*{[.\s\S]*init\s*\((.*?)\)[.\s\S]*})?/g.exec(n);if(!r||r.length<2)throw new Error("Contract Error: can't find name of the contract");return{contractName:r[1],args:r[3]||""}},D=t=>{const n=N(I(t));if(/transaction\s*(\(\s*\))*\s*/g.test(n)){const t=C(n),r=B(n);return{type:S,signers:t.length,args:r}}if(/pub\s+fun\s+main\s*/g.test(n)){const t=A(n);return{type:T,args:t}}if(/\w+\s+contract\s+(\w*\s*)\w*/g.test(n)){const{contractName:t,args:r}=q(n);return{type:$,signers:1,args:r,contractName:t}}return{type:"unknown"}},O=t=>!t||"string"!=typeof t,L=t=>!O(t)&&(t.startsWith("Int")||t.startsWith("UInt")||t.startsWith("Word")),U=t=>"Path"===t||"Path?"===t||"PublicPath"===t||"PublicPath?"===t||"PrivatePath"===t||"PrivatePath?"===t||"StoragePath"===t||"StoragePath?"===t||"CapabilityPath"===t||"CapabilityPath?"===t,K=t=>{if(O(t))return!1;const n=t.replace(/\s/g,"");return n.startsWith("[")&&n.endsWith("]")},M=t=>{if(O(t))return!1;const n=t.replace(/\s/g,"");return n.startsWith("{")&&n.endsWith("}")},R=t=>K(t)||M(t)||U(t);function _(t,n,r){if(!t.s){if(r instanceof G){if(!r.s)return void(r.o=_.bind(null,t,n));1&n&&(n=r.s),r=r.v}if(r&&r.then)return void r.then(_.bind(null,t,n),_.bind(null,t,2));t.s=n,t.v=r;const e=t.o;e&&e(t)}}const G=function(){function t(){}return t.prototype.then=function(n,r){const e=new t,o=this.s;if(o){const t=1&o?n:r;if(t){try{_(e,1,t(this.v))}catch(t){_(e,2,t)}return e}return this}return this.o=function(t){try{const o=t.v;1&t.s?_(e,1,n?n(o):o):r?_(e,1,r(o)):_(e,2,o)}catch(t){_(e,2,t)}},e},t}(),H={ARGUMENT:"argument"},Q=function(t){try{return Promise.resolve(e.config().get("ix.plugins")).then(function(n){const r=(n||{})[t];return!!(r&&r.length>0)&&r})}catch(t){return Promise.reject(t)}};function z(t,n,r){if(!t.s){if(r instanceof W){if(!r.s)return void(r.o=z.bind(null,t,n));1&n&&(n=r.s),r=r.v}if(r&&r.then)return void r.then(z.bind(null,t,n),z.bind(null,t,2));t.s=n,t.v=r;const e=t.o;e&&e(t)}}const W=function(){function t(){}return t.prototype.then=function(n,r){const e=new t,o=this.s;if(o){const t=1&o?n:r;if(t){try{z(e,1,t(this.v))}catch(t){z(e,2,t)}return e}return this}return this.o=function(t){try{const o=t.v;1&t.s?z(e,1,n?n(o):o):r?z(e,1,r(o)):z(e,2,o)}catch(t){z(e,2,t)}},e},t}(),J=t=>t.split(/(\w+)\s*:\s*([\w{}[\]:\s?]*)/).filter(t=>""!==t).map(t=>t.replace(/\s*/g,"")),V=t=>J(t)[1],X=t=>/{(.*)}/.exec(t)[1].split(/([^:]*):(.*)/).map(t=>t.replace(/\s/g,"")).filter(t=>t),Y=t=>/\[(.*)\]/.exec(t)[1].replace(/\s+/g,""),Z=t=>!O(t)&&(t.includes("?")?s.Optional(s[(t=>t.slice(0,-1))(t)]):s[t]),tt=t=>{if(R(t))switch(!0){case K(t):{const n=Y(t);return s.Array(tt(n))}case M(t):{const[n,r]=X(t),e={key:tt(n),value:tt(r)};return s.Dictionary(e)}case U(t):return s.Path;default:return Z(t)}return Z(t)},nt=function(t,n){try{return Promise.resolve(Q(H.ARGUMENT)).then(function(r){function e(){let t;const n=tt(c);switch(!0){case(t=>{if(O(t))return!1;let n=t.endsWith("?")?t.slice(0,-1):t;return L(n)||(t=>"String"===t)(n)||(t=>"Character"===t)(n)||(t=>"Bool"===t)(n)})(c):return u.arg(o,n);case(t=>!O(t)&&(t.startsWith("Fix64")||t.startsWith("UFix64")))(c):return null===o?u.arg(null,n):(isNaN(parseFloat(o))&&(t=>{throw new Error("Type Error: Expected proper value for fixed type")})(),u.arg(parseFloat(o).toFixed(8),n));case(t=>"Address"===t||"Address?"===t)(c):{const t=null==(d=o)?null:"0x"+(t=>null==t?null:t.replace(/^0x/,""))(d);return u.arg(t,n)}case U(c):return u.arg((t=>{if(t.startsWith("/")){const n=t.slice(1).split("/");if(2!==n.length)throw Error("Incorrect Path - identifier missing");if(!b.includes(n[0]))throw Error("Incorrect Path - wrong domain");const[r,e]=n;return{domain:r,identifier:e}}throw Error("Incorrect Path - shall start with `/`")})(o),n);case K(c):{function r(r){return t?r:u.arg(o,n)}const e=Y(c),i=function(){if(R(e))return Promise.resolve(Promise.all(o.map(function(t){try{return Promise.resolve(nt(e,t)).then(function({value:t}){return t})}catch(t){return Promise.reject(t)}}))).then(function(r){return t=1,u.arg(r,n)})}();return i&&i.then?i.then(r):r(i)}case M(c):{function e(){return u.arg(d,n)}const[t,r]=X(c),d=[],m=Object.keys(o),h=(i=m,s=function(n){function e(){const n=L(t)?parseInt(c):c;d.push({key:n,value:i})}const c=m[n];let i;const s=function(){if(R(r))return Promise.resolve(nt(r,o[c])).then(function(t){i=t.value});i=o[c]}();return s&&s.then?s.then(e):e()},l=-1,function t(n){try{for(;++l<i.length;)if((n=s(l))&&n.then){if(!((r=n)instanceof W&&1&r.s))return void n.then(t,f||(f=z.bind(null,a=new W,2)));n=n.v}a?z(a,1,n):a=n}catch(t){z(a||(a=new W),2,t)}var r}(),a);return h&&h.then?h.then(e):e()}default:throw`${c} is not supported`}var i,s,a,f,l,d}let o=n,c=t;const i=function(){if(r)return Promise.resolve(function(t,n){try{function r(){return{type:u,value:a}}let u=t.type,a=t.value;const f=(e=n,o=function(t){const{resolver:r}=n[t];return Promise.resolve(r(u,a)).then(function(t){u=t.type,a=t.value})},s=-1,function t(n){try{for(;++s<e.length;)if((n=o(s))&&n.then){if(!((r=n)instanceof G&&1&r.s))return void n.then(t,i||(i=_.bind(null,c=new G,2)));n=n.v}c?_(c,1,n):c=n}catch(t){_(c||(c=new G),2,t)}var r}(),c);return Promise.resolve(f&&f.then?f.then(r):r())}catch(t){return Promise.reject(t)}var e,o,c,i,s}({type:t,value:n},r)).then(function(t){o=t.value,c=t.type})}();return i&&i.then?i.then(e):e()})}catch(t){return Promise.reject(t)}},rt=function(t=[],n){try{if(t.length>n.length)throw new Error("Not enough arguments");return Promise.all(n.map(function(n,r){try{return Promise.resolve(nt(t[r],n)).then(function(t){var n;return(n=t).xform.asArgument(n.value),t})}catch(t){return Promise.reject(t)}}))}catch(t){return Promise.reject(t)}},et=function(t,n=[]){try{const r=D(t).args.map(V);return rt(r,n)}catch(t){return Promise.reject(t)}},ot=function(t,n){try{if(0===t.length)return Promise.resolve([]);const r=t[0];return Array.isArray(r)&&r.length>0&&r[r.length-1].asArgument?Promise.resolve((t=>t.reduce((t,n)=>[...t,...((t,n)=>{const r=t[t.length-1];return t.slice(0,-1).map(t=>((t,n)=>u.arg(t,n))(t,r))})(n)],[]))(t)):et(n,t)}catch(t){return Promise.reject(t)}},ct=23830813,it=t=>null==t?null:t.replace(/^0x/,""),st=function(){try{return Promise.resolve(e.send([e.getBlock(!0)]).then(e.decode))}catch(t){return Promise.reject(t)}},ut=function(){try{return Promise.resolve(st()).then(function(t){return t.height})}catch(t){return Promise.reject(t)}},at=t=>{const{address:n,contractName:r,eventName:e}=t;return`A.${it(n)}.${r}.${e}`},ft=function(t,n){try{function r(){return c<ct&&(console.warn(`"to" value of range is lower than current spork root. setting to ${ct}`),c=ct),o<ct&&(console.warn(`"from" value of range is lower than current spork root. setting to ${ct}`),o=ct),e.send([e.getEventsAtBlockHeightRange(at(t),o,c)]).then(e.decode)}if(!t.address)throw"contract shall have address field";if(!t.contractName)throw"contract shall have contractName field";if(!t.eventName)throw"contract shall have event name";let o,c;const i=function(){if(n){function t(){n.from||(o=c-249)}c=n.to,o=n.from;const r=function(){if(!n.to)return Promise.resolve(ut()).then(function(t){c=t})}();return r&&r.then?r.then(t):t()}return Promise.resolve(ut()).then(function(t){c=t,o=c-249,o<ct&&(console.warn(`"from" value of range is lower than current spork root. setting to ${ct}`),o=ct)})}();return Promise.resolve(i&&i.then?i.then(r):r())}catch(t){return Promise.reject(t)}},lt=new o.ec("p256"),dt=(t,n)=>{const r=lt.keyFromPrivate(Buffer.from(t,"hex")).sign((t=>{const n=new c.SHA3(256);return n.update(Buffer.from(t,"hex")),n.digest()})(n)),e=r.r.toArrayLike(Buffer,"be",32),o=r.s.toArrayLike(Buffer,"be",32);return Buffer.concat([e,o]).toString("hex")},mt=t=>{if("object"==typeof t){if(void 0===t.privateKey)throw Error("privateKey is required");if(void 0===t.address)throw Error("address is required");void 0===t.keyId&&console.warning(`key index have incorrect format. found '${typeof t.keyId}', required 'num'`);const{address:n,privateKey:r,keyId:e=0}=t;return((t,n,r=0)=>function(e={}){try{t=it(t);const o=function(e){try{return Promise.resolve({keyId:r,addr:(o=t,null==o?null:"0x"+it(o)),signature:dt(n,e.message)})}catch(t){return Promise.reject(t)}var o};return Promise.resolve({...e,tempId:`${t}-${r}`,addr:u.sansPrefix(t),keyId:r,signingFunction:o})}catch(t){return Promise.reject(t)}})(n,r,e)}return t};function ht(t,n){try{var r=t()}catch(t){return n(t)}return r&&r.then?r.then(void 0,n):r}const pt=function(t,r){try{const{code:e,cadence:o,args:c,addressMap:i,limit:s,processed:a}=t,f=e||o;return Promise.resolve(m()).then(function(e){function o(){return Promise.resolve(n.config().get("ix.executionLimit")).then(function(n){if(m.push(u.limit(s||n||100)),"transaction"===r){const{proposer:n,payer:r,signers:e=[]}=t,o=0===e.length?[r]:e,c=n||r;m.push(u.payer(mt(r))),m.push(u.proposer(mt(c))),m.push(u.authorizations(o.map(mt)))}return u.send(m)})}const l={...e,...i},d=a?f:x(f,l),m="script"===r?[u.script(d)]:[u.transaction(d)],h=function(){if(c)return Promise.resolve(ot(c,f)).then(function(t){m.push(u.args(t))})}();return h&&h.then?h.then(o):o()})}catch(t){return Promise.reject(t)}},gt=function(t){const{raw:n=!1}=t;return Promise.resolve(ht(function(){return Promise.resolve(pt(t,"script")).then(function(t){return n?[t.encodedData,null]:Promise.resolve(u.decode(t)).then(function(t){return[t,null]})})},function(t){return[null,t]}))},Pt=function(t){const{wait:n="seal"}=t;return Promise.resolve(ht(function(){return Promise.resolve(pt(t,"transaction")).then(function(t){let r;function e(n){return r?n:[t.transactionId,null]}const o=function(){if(n){const e=(t=>{if("string"==typeof t){const n=t.toLowerCase();if(n.includes("final"))return"onceFinalized";if(n.includes("exec"))return"onceExecuted";if(n.includes("seal"))return"onceSealed"}return console.log(`⚠️ [33mStatus value [1m[35m"${t}"[33m[2m is not supported. Reverting to [32m"onceSealed"[0m`),"onceSealed"})(n);return Promise.resolve(u.tx(t)[e]()).then(function(n){const e={txId:t,...n};return r=1,[e,null]})}}();return o&&o.then?o.then(e):e(o)})},function(t){return[null,t]}))},wt=function(t){try{const{name:n,to:r,payer:e,proposer:o,code:c,update:i=!1,processed:s=!1,addressMap:u={}}=t,a=s?c:x(c,u),f=i?"\n    transaction(name: String, code: String) {\n      prepare(acct: AuthAccount){\n        let decoded = code.decodeHex()\n        \n        acct.contracts.add(\n          name: name,\n          code: decoded,\n        )\n      }\n    }\n  ":"\n  transaction(name: String, code: String){\n    prepare(acct: AuthAccount){\n      let decoded = code.decodeHex()\n      \n      if acct.contracts.get(name: name) == nil {\n        acct.contracts.add(name: name, code: decoded)\n      } else {\n        acct.contracts.update__experimental(name: name, code: decoded)\n      }\n    }\n  }\n",l=Buffer.from(a,"utf8").toString("hex");let d=r,m=r;return e&&(m=e,d=o||e),Pt({payer:m,proposer:d,signers:[r],code:f,args:[n,l]})}catch(t){return Promise.reject(t)}};t.CONTRACT=$,t.CURRENT_SPORK_NUMBER=16,t.CURRENT_SPORK_ROOT=ct,t.PLUGIN_TYPES=H,t.SCRIPT=T,t.TRANSACTION=S,t.argType=V,t.capitalizeFirstLetter=v,t.collapseSpaces=F,t.deployContract=wt,t.executeScript=gt,t.extendEnvironment=l,t.extract=j,t.extractContractName=t=>q(t).contractName,t.extractContractParameters=q,t.extractImports=g,t.extractScriptArguments=A,t.extractSigners=C,t.extractTransactionArguments=B,t.findLatestEvents=function(t,n={}){try{function r(n){let r=n-e;return n<s&&(console.warn(`"to" value of range is lower than current spork root. setting to ${ct}`),n=s),r<s&&(console.warn(`"from" value of range is lower than current spork root. setting to ${ct}`),r=s),new Promise((c,s)=>{const a=function(){try{const f=function(s,f){try{var l=(console.log(`${r} -> ${n}...`),Promise.resolve(ft(t,{from:r,to:n})).then(function(t){0!==t.length?(clearInterval(void 0),c({events:t})):(u>i&&c({events:t,latestBlock:n}),n=r,r-=e,u+=e,setTimeout(a,o))}))}catch(t){return f(t)}return l&&l.then?l.then(void 0,f):l}(0,function(t){s({events:[],err:t,latestBlock:n})});return Promise.resolve(f&&f.then?f.then(function(){}):void 0)}catch(t){return Promise.reject(t)}};setTimeout(a,o)})}const{step:e=200,delay:o=500,start:c=null,maxRange:i=Infinity,sporkLimit:s=ct}=n;let u=e;return Promise.resolve(c?r(c):Promise.resolve(ut()).then(r))}catch(t){return Promise.reject(t)}},t.generateSchema=E,t.getArrayType=Y,t.getChainHeight=ut,t.getDictionaryTypes=X,t.getEnvironment=m,t.getEventName=at,t.getEventsInRange=ft,t.getLatestBlock=st,t.getPlugins=Q,t.getPragmaNotes=t=>t.match(/\/{3}\s*pragma\s*(.*)/g).reduce((t,n)=>{const r=n.match(/\/{3}\s*pragma\s+(\w*)\s+(.*)/),[,e,o]=r;return t[e]=o,t},{}),t.getSplitCharacter=k,t.getTemplateInfo=D,t.mapArgument=nt,t.mapArguments=rt,t.mapValuesToCode=et,t.missingImports=P,t.mutate=Pt,t.query=gt,t.registerPlugin=function(t){try{const{type:n}=t;return Promise.resolve(e.config().get("ix.plugins")).then(function(r){const o=r||{},c=o[n]||[];return Promise.resolve(e.config().put("ix.plugins",{...o,[n]:[...c,t]})).then(function(){})})}catch(t){return Promise.reject(t)}},t.replaceImportAddresses=x,t.report=w,t.reportArguments=(t,n,r="")=>{if(n>t){const e=`Incorrect number of arguments: found ${t} of ${n}`;console.error(r?`${r} ${e}`:e)}},t.reportMissing=(t="items",n,r,e="")=>{if(r!==n){const o=`Incorrect number of ${t}: found ${n} of ${r}`;console.error(e?`${e} ${o}`:o)}},t.reportMissingImports=(t,n,r="")=>{const e=P(t,n);e.length>0&&w(e,r)},t.resolveArguments=ot,t.sendTransaction=Pt,t.setEnvironment=function(t="emulator",r={}){try{const e=t.toLowerCase();if(!a[e])throw new Error(`Provided value "${e}" is not supported. Try "emulator", "testnet" or "mainnet". Default: "emulator"`);const{port:o,endpoint:c,limit:i,extend:s}=r,u="emulator"===e&&o?`http://localhost:${o}`:d[e],f=c||u;return Promise.resolve(n.config().put("ix.env",e)).then(function(){function t(){return s&&l(s),Promise.resolve(n.config().put("accessNode.api",f)).then(function(){})}const r=function(){if(i)return Promise.resolve(n.config().put("ix.executionLimit",i)).then(function(){})}();return r&&r.then?r.then(t):t()})}catch(t){return Promise.reject(t)}},t.splitArgs=J,t.stripComments=I,t.stripStrings=N,t.trimAndSplit=(t,n,r)=>r?t.replace(n,"").split(r):t.replace(n,"").split(k(t)),t.underscoreToCamelCase=t=>t.replace(/-/g,"_").split("_").map((t,n)=>n>0?v(t):t).join(""),t.updateContract=function(t){try{return wt({...t,update:!0})}catch(t){return Promise.reject(t)}}});
//# sourceMappingURL=main.umd.js.map
