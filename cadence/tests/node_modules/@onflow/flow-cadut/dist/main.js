var t=require("@onflow/config"),r=require("@onflow/types"),e=require("@onflow/fcl"),n=require("elliptic"),o=require("sha3");function c(t){if(t&&t.t)return t;var r=Object.create(null);return t&&Object.keys(t).forEach(function(e){if("default"!==e){var n=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(r,e,n.get?n:{enumerable:!0,get:function(){return t[e]}})}}),r.default=t,r}var s=c(r),i=c(e);const u={emulator:{FungibleToken:"0xee82856bf20e2aa6",FlowFees:"0xe5a8b7f23e8b548f",FlowStorageFees:"0xf8d6e0586b0a20c7",FlowToken:"0x0ae53cb6e3f42a79"},testnet:{FungibleToken:"0x9a0766d93b6608b7",NonFungibleToken:"0x631e88ae7f1d7c20",FlowClusterQC:"0x9eca2b38b18b5dfe",FlowDKG:"0x9eca2b38b18b5dfe",FlowEpoch:"0x9eca2b38b18b5dfe",FlowIDTableStaking:"0x9eca2b38b18b5dfe",FlowToken:"0x7e60df042a9c0868",LockedTokens:"0x95e019a17d0e23d7",StakingProxy:"0x7aad92e5a0715d21",FlowStakingCollection:"0x95e019a17d0e23d7",FUSD:"0xe223d8a629e49c68"},mainnet:{FungibleToken:"0xf233dcee88fe0abe",NonFungibleToken:"0x1d7e57aa55817448",FlowClusterQC:"0x8624b52f9ddcd04a",FlowDKG:"0x8624b52f9ddcd04a",FlowEpoch:"0x8624b52f9ddcd04a",FlowIDTableStaking:"0x8624b52f9ddcd04a",FlowFees:"0xf919ee77447b7497",FlowToken:"0x1654653399040a61",LockedTokens:"0x8d0e87b65159ae63",StakingProxy:"0x62430cf28c26d095",FlowStakingCollection:"0x8d0e87b65159ae63",FUSD:"0x3c5959b568896393"}},a={emulator:{},testnet:{},mainnet:{}},f=t=>{for(const r of Object.keys(a)){const e=t[r],{name:n}=t;a[r]={...a[r],..."object"==typeof t[r]?e:{[n]:e}}}},l={mainnet:"https://access-mainnet-beta.onflow.org",testnet:"https://access-testnet.onflow.org",emulator:"http://localhost:8080"},d=function(){try{return Promise.resolve(function(){try{return Promise.resolve(t.config().get("ix.env")).then(function(t){return t||"emulator"})}catch(t){return Promise.reject(t)}}()).then(function(t){return{...u[t]||u.emulator,...a[t]||a.emulator}})}catch(t){return Promise.reject(t)}},p=t=>t.split(/\s/).map(t=>t.replace(/\s/g,"")).filter(t=>t.length>0&&"import"!==t&&"from"!==t),m=(t,r)=>{const[e,n]=r;return t[e]=n,t},x=t=>t&&0!==t.length?t.split("\n").filter(t=>/^\s*import\s+\w*\s+from/.test(t)).map(p).reduce(m,{}):{},h=(t,r={})=>{const e=x(t),n=[];for(const t in e)!r[t]&&Object.prototype.hasOwnProperty.call(e,t)&&n.push(t);return n},g=(t=[],r="")=>{const e="Missing imports for contracts:";console.error(r?`${r} ${e}`:e,t)},P=/(\s*import\s*)([\w\d]+)(\s+from\s*)([\w\d".\\/]+)/g,w=(t,r,e=!0)=>t.replace(P,(t,n,o,c,s)=>{const i=e?o:s;return`${n}${o} from ${(r instanceof Function?r(i):r[i])||s}`}),y=["public","private","storage"],v=t=>{const[r]=t.split("");return r.toUpperCase()+t.slice(1)},b=t=>{switch(!0){case t.indexOf("//")>=0:return"//";case t.indexOf("/")>=0:return"/";case t.indexOf("\\")>=0:return"\\";default:return""}},k=t=>t.replace(/\s+/g," "),F=t=>t.split(",").map(t=>t.replace(/\s*/g,"")).filter(t=>""!==t),$=t=>t.replace(/(\/\*[\s\S]*?\*\/)|(\/\/.*)/g,""),S=t=>{let r=!1,e="";for(let n=0;n<t.length;n++)'"'===t[n]&&(r&&"\\"!==t[n-1]?(r=!1,e+=t[n]):r=!0),r||(e+=t[n]);return e},E=(t,r)=>{const e=$(t),n=k(e.replace(/[\n\r]/g,""));if(n){const t=new RegExp(r,"g").exec(n);if(t)return""===t[1]?[]:F(t[1])}return[]},I=t=>E(t,"(?:prepare\\s*\\(\\s*)([^\\)]*)(?:\\))"),T=t=>E(t,"(?:fun\\s+main\\s*\\(\\s*)([^\\)]*)(?:\\))"),N=t=>E(t,"(?:transaction\\s*\\(\\s*)([^\\)]*)(?:\\))"),C=t=>{const r=$(t).replace(/(resource|struct)\s+\w+\s*{[\s\S]+?}/g,""),e=/(?:access\(\w+\)|pub)\s+contract\s+(?:interface)*\s*(\w*)(\s*{[.\s\S]*init\s*\((.*?)\)[.\s\S]*})?/g.exec(r);if(!e||e.length<2)throw new Error("Contract Error: can't find name of the contract");return{contractName:e[1],args:e[3]||""}},j=t=>{const r=S($(t));if(/transaction\s*(\(\s*\))*\s*/g.test(r)){const t=I(r),e=N(r);return{type:"transaction",signers:t.length,args:e}}if(/pub\s+fun\s+main\s*/g.test(r))return{type:"script",args:T(r)};if(/\w+\s+contract\s+(\w*\s*)\w*/g.test(r)){const{contractName:t,args:e}=C(r);return{type:"contract",signers:1,args:e,contractName:t}}return{type:"unknown"}},A=t=>!t||"string"!=typeof t,B=t=>!A(t)&&(t.startsWith("Int")||t.startsWith("UInt")||t.startsWith("Word")),q=t=>"Path"===t||"Path?"===t||"PublicPath"===t||"PublicPath?"===t||"PrivatePath"===t||"PrivatePath?"===t||"StoragePath"===t||"StoragePath?"===t||"CapabilityPath"===t||"CapabilityPath?"===t,D=t=>{if(A(t))return!1;const r=t.replace(/\s/g,"");return r.startsWith("[")&&r.endsWith("]")},O=t=>{if(A(t))return!1;const r=t.replace(/\s/g,"");return r.startsWith("{")&&r.endsWith("}")},L=t=>D(t)||O(t)||q(t);function U(t,r,e){if(!t.s){if(e instanceof K){if(!e.s)return void(e.o=U.bind(null,t,r));1&r&&(r=e.s),e=e.v}if(e&&e.then)return void e.then(U.bind(null,t,r),U.bind(null,t,2));t.s=r,t.v=e;const n=t.o;n&&n(t)}}const K=function(){function t(){}return t.prototype.then=function(r,e){const n=new t,o=this.s;if(o){const t=1&o?r:e;if(t){try{U(n,1,t(this.v))}catch(t){U(n,2,t)}return n}return this}return this.o=function(t){try{const o=t.v;1&t.s?U(n,1,r?r(o):o):e?U(n,1,e(o)):U(n,2,o)}catch(t){U(n,2,t)}},n},t}(),M={ARGUMENT:"argument"},R=function(t){try{return Promise.resolve(e.config().get("ix.plugins")).then(function(r){const e=(r||{})[t];return!!(e&&e.length>0)&&e})}catch(t){return Promise.reject(t)}};function _(t,r,e){if(!t.s){if(e instanceof G){if(!e.s)return void(e.o=_.bind(null,t,r));1&r&&(r=e.s),e=e.v}if(e&&e.then)return void e.then(_.bind(null,t,r),_.bind(null,t,2));t.s=r,t.v=e;const n=t.o;n&&n(t)}}const G=function(){function t(){}return t.prototype.then=function(r,e){const n=new t,o=this.s;if(o){const t=1&o?r:e;if(t){try{_(n,1,t(this.v))}catch(t){_(n,2,t)}return n}return this}return this.o=function(t){try{const o=t.v;1&t.s?_(n,1,r?r(o):o):e?_(n,1,e(o)):_(n,2,o)}catch(t){_(n,2,t)}},n},t}(),H=t=>t.split(/(\w+)\s*:\s*([\w{}[\]:\s?]*)/).filter(t=>""!==t).map(t=>t.replace(/\s*/g,"")),Q=t=>H(t)[1],z=t=>/{(.*)}/.exec(t)[1].split(/([^:]*):(.*)/).map(t=>t.replace(/\s/g,"")).filter(t=>t),W=t=>/\[(.*)\]/.exec(t)[1].replace(/\s+/g,""),J=t=>!A(t)&&(t.includes("?")?s.Optional(s[(t=>t.slice(0,-1))(t)]):s[t]),V=t=>{if(L(t))switch(!0){case D(t):{const r=W(t);return s.Array(V(r))}case O(t):{const[r,e]=z(t),n={key:V(r),value:V(e)};return s.Dictionary(n)}case q(t):return s.Path;default:return J(t)}return J(t)},X=function(t,r){try{return Promise.resolve(R(M.ARGUMENT)).then(function(e){function n(){let t;const r=V(c);switch(!0){case(t=>{if(A(t))return!1;let r=t.endsWith("?")?t.slice(0,-1):t;return B(r)||(t=>"String"===t)(r)||(t=>"Character"===t)(r)||(t=>"Bool"===t)(r)})(c):return i.arg(o,r);case(t=>!A(t)&&(t.startsWith("Fix64")||t.startsWith("UFix64")))(c):return null===o?i.arg(null,r):(isNaN(parseFloat(o))&&(t=>{throw new Error("Type Error: Expected proper value for fixed type")})(),i.arg(parseFloat(o).toFixed(8),r));case(t=>"Address"===t||"Address?"===t)(c):{const t=null==(d=o)?null:"0x"+(t=>null==t?null:t.replace(/^0x/,""))(d);return i.arg(t,r)}case q(c):return i.arg((t=>{if(t.startsWith("/")){const r=t.slice(1).split("/");if(2!==r.length)throw Error("Incorrect Path - identifier missing");if(!y.includes(r[0]))throw Error("Incorrect Path - wrong domain");const[e,n]=r;return{domain:e,identifier:n}}throw Error("Incorrect Path - shall start with `/`")})(o),r);case D(c):{function e(e){return t?e:i.arg(o,r)}const n=W(c),s=function(){if(L(n))return Promise.resolve(Promise.all(o.map(function(t){try{return Promise.resolve(X(n,t)).then(function({value:t}){return t})}catch(t){return Promise.reject(t)}}))).then(function(e){return t=1,i.arg(e,r)})}();return s&&s.then?s.then(e):e(s)}case O(c):{function n(){return i.arg(d,r)}const[t,e]=z(c),d=[],p=Object.keys(o),m=(s=p,u=function(r){function n(){const r=B(t)?parseInt(c):c;d.push({key:r,value:s})}const c=p[r];let s;const i=function(){if(L(e))return Promise.resolve(X(e,o[c])).then(function(t){s=t.value});s=o[c]}();return i&&i.then?i.then(n):n()},l=-1,function t(r){try{for(;++l<s.length;)if((r=u(l))&&r.then){if(!((e=r)instanceof G&&1&e.s))return void r.then(t,f||(f=_.bind(null,a=new G,2)));r=r.v}a?_(a,1,r):a=r}catch(t){_(a||(a=new G),2,t)}var e}(),a);return m&&m.then?m.then(n):n()}default:throw`${c} is not supported`}var s,u,a,f,l,d}let o=r,c=t;const s=function(){if(e)return Promise.resolve(function(t,r){try{function e(){return{type:u,value:a}}let u=t.type,a=t.value;const f=(n=r,o=function(t){const{resolver:e}=r[t];return Promise.resolve(e(u,a)).then(function(t){u=t.type,a=t.value})},i=-1,function t(r){try{for(;++i<n.length;)if((r=o(i))&&r.then){if(!((e=r)instanceof K&&1&e.s))return void r.then(t,s||(s=U.bind(null,c=new K,2)));r=r.v}c?U(c,1,r):c=r}catch(t){U(c||(c=new K),2,t)}var e}(),c);return Promise.resolve(f&&f.then?f.then(e):e())}catch(t){return Promise.reject(t)}var n,o,c,s,i}({type:t,value:r},e)).then(function(t){o=t.value,c=t.type})}();return s&&s.then?s.then(n):n()})}catch(t){return Promise.reject(t)}},Y=function(t=[],r){try{if(t.length>r.length)throw new Error("Not enough arguments");return Promise.all(r.map(function(r,e){try{return Promise.resolve(X(t[e],r)).then(function(t){var r;return(r=t).xform.asArgument(r.value),t})}catch(t){return Promise.reject(t)}}))}catch(t){return Promise.reject(t)}},Z=function(t,r=[]){try{const e=j(t).args.map(Q);return Y(e,r)}catch(t){return Promise.reject(t)}},tt=function(t,r){try{if(0===t.length)return Promise.resolve([]);const e=t[0];return Array.isArray(e)&&e.length>0&&e[e.length-1].asArgument?Promise.resolve((t=>t.reduce((t,r)=>[...t,...((t,r)=>{const e=t[t.length-1];return t.slice(0,-1).map(t=>((t,r)=>i.arg(t,r))(t,e))})(r)],[]))(t)):Z(r,t)}catch(t){return Promise.reject(t)}},rt=23830813,et=t=>null==t?null:t.replace(/^0x/,""),nt=function(){try{return Promise.resolve(e.send([e.getBlock(!0)]).then(e.decode))}catch(t){return Promise.reject(t)}},ot=function(){try{return Promise.resolve(nt()).then(function(t){return t.height})}catch(t){return Promise.reject(t)}},ct=t=>{const{address:r,contractName:e,eventName:n}=t;return`A.${et(r)}.${e}.${n}`},st=function(t,r){try{function n(){return c<rt&&(console.warn(`"to" value of range is lower than current spork root. setting to ${rt}`),c=rt),o<rt&&(console.warn(`"from" value of range is lower than current spork root. setting to ${rt}`),o=rt),e.send([e.getEventsAtBlockHeightRange(ct(t),o,c)]).then(e.decode)}if(!t.address)throw"contract shall have address field";if(!t.contractName)throw"contract shall have contractName field";if(!t.eventName)throw"contract shall have event name";let o,c;const s=function(){if(r){function t(){r.from||(o=c-249)}c=r.to,o=r.from;const e=function(){if(!r.to)return Promise.resolve(ot()).then(function(t){c=t})}();return e&&e.then?e.then(t):t()}return Promise.resolve(ot()).then(function(t){c=t,o=c-249,o<rt&&(console.warn(`"from" value of range is lower than current spork root. setting to ${rt}`),o=rt)})}();return Promise.resolve(s&&s.then?s.then(n):n())}catch(t){return Promise.reject(t)}},it=new n.ec("p256"),ut=(t,r)=>{const e=it.keyFromPrivate(Buffer.from(t,"hex")).sign((t=>{const r=new o.SHA3(256);return r.update(Buffer.from(t,"hex")),r.digest()})(r)),n=e.r.toArrayLike(Buffer,"be",32),c=e.s.toArrayLike(Buffer,"be",32);return Buffer.concat([n,c]).toString("hex")},at=t=>{if("object"==typeof t){if(void 0===t.privateKey)throw Error("privateKey is required");if(void 0===t.address)throw Error("address is required");void 0===t.keyId&&console.warning(`key index have incorrect format. found '${typeof t.keyId}', required 'num'`);const{address:r,privateKey:e,keyId:n=0}=t;return((t,r,e=0)=>function(n={}){try{t=et(t);const o=function(n){try{return Promise.resolve({keyId:e,addr:(o=t,null==o?null:"0x"+et(o)),signature:ut(r,n.message)})}catch(t){return Promise.reject(t)}var o};return Promise.resolve({...n,tempId:`${t}-${e}`,addr:i.sansPrefix(t),keyId:e,signingFunction:o})}catch(t){return Promise.reject(t)}})(r,e,n)}return t};function ft(t,r){try{var e=t()}catch(t){return r(t)}return e&&e.then?e.then(void 0,r):e}const lt=function(r,e){try{const{code:n,cadence:o,args:c,addressMap:s,limit:u,processed:a}=r,f=n||o;return Promise.resolve(d()).then(function(n){function o(){return Promise.resolve(t.config().get("ix.executionLimit")).then(function(t){if(p.push(i.limit(u||t||100)),"transaction"===e){const{proposer:t,payer:e,signers:n=[]}=r,o=0===n.length?[e]:n,c=t||e;p.push(i.payer(at(e))),p.push(i.proposer(at(c))),p.push(i.authorizations(o.map(at)))}return i.send(p)})}const l={...n,...s},d=a?f:w(f,l),p="script"===e?[i.script(d)]:[i.transaction(d)],m=function(){if(c)return Promise.resolve(tt(c,f)).then(function(t){p.push(i.args(t))})}();return m&&m.then?m.then(o):o()})}catch(t){return Promise.reject(t)}},dt=function(t){const{raw:r=!1}=t;return Promise.resolve(ft(function(){return Promise.resolve(lt(t,"script")).then(function(t){return r?[t.encodedData,null]:Promise.resolve(i.decode(t)).then(function(t){return[t,null]})})},function(t){return[null,t]}))},pt=function(t){const{wait:r="seal"}=t;return Promise.resolve(ft(function(){return Promise.resolve(lt(t,"transaction")).then(function(t){let e;function n(r){return e?r:[t.transactionId,null]}const o=function(){if(r){const n=(t=>{if("string"==typeof t){const r=t.toLowerCase();if(r.includes("final"))return"onceFinalized";if(r.includes("exec"))return"onceExecuted";if(r.includes("seal"))return"onceSealed"}return console.log(`⚠️ [33mStatus value [1m[35m"${t}"[33m[2m is not supported. Reverting to [32m"onceSealed"[0m`),"onceSealed"})(r);return Promise.resolve(i.tx(t)[n]()).then(function(r){const n={txId:t,...r};return e=1,[n,null]})}}();return o&&o.then?o.then(n):n(o)})},function(t){return[null,t]}))},mt=function(t){try{const{name:r,to:e,payer:n,proposer:o,code:c,update:s=!1,processed:i=!1,addressMap:u={}}=t,a=i?c:w(c,u),f=s?"\n    transaction(name: String, code: String) {\n      prepare(acct: AuthAccount){\n        let decoded = code.decodeHex()\n        \n        acct.contracts.add(\n          name: name,\n          code: decoded,\n        )\n      }\n    }\n  ":"\n  transaction(name: String, code: String){\n    prepare(acct: AuthAccount){\n      let decoded = code.decodeHex()\n      \n      if acct.contracts.get(name: name) == nil {\n        acct.contracts.add(name: name, code: decoded)\n      } else {\n        acct.contracts.update__experimental(name: name, code: decoded)\n      }\n    }\n  }\n",l=Buffer.from(a,"utf8").toString("hex");let d=e,p=e;return n&&(p=n,d=o||n),pt({payer:p,proposer:d,signers:[e],code:f,args:[r,l]})}catch(t){return Promise.reject(t)}};exports.CONTRACT="contract",exports.CURRENT_SPORK_NUMBER=16,exports.CURRENT_SPORK_ROOT=rt,exports.PLUGIN_TYPES=M,exports.SCRIPT="script",exports.TRANSACTION="transaction",exports.argType=Q,exports.capitalizeFirstLetter=v,exports.collapseSpaces=k,exports.deployContract=mt,exports.executeScript=dt,exports.extendEnvironment=f,exports.extract=E,exports.extractContractName=t=>C(t).contractName,exports.extractContractParameters=C,exports.extractImports=x,exports.extractScriptArguments=T,exports.extractSigners=I,exports.extractTransactionArguments=N,exports.findLatestEvents=function(t,r={}){try{function e(r){let e=r-n;return r<i&&(console.warn(`"to" value of range is lower than current spork root. setting to ${rt}`),r=i),e<i&&(console.warn(`"from" value of range is lower than current spork root. setting to ${rt}`),e=i),new Promise((c,i)=>{const a=function(){try{const f=function(i,f){try{var l=(console.log(`${e} -> ${r}...`),Promise.resolve(st(t,{from:e,to:r})).then(function(t){0!==t.length?(clearInterval(void 0),c({events:t})):(u>s&&c({events:t,latestBlock:r}),r=e,e-=n,u+=n,setTimeout(a,o))}))}catch(t){return f(t)}return l&&l.then?l.then(void 0,f):l}(0,function(t){i({events:[],err:t,latestBlock:r})});return Promise.resolve(f&&f.then?f.then(function(){}):void 0)}catch(t){return Promise.reject(t)}};setTimeout(a,o)})}const{step:n=200,delay:o=500,start:c=null,maxRange:s=Infinity,sporkLimit:i=rt}=r;let u=n;return Promise.resolve(c?e(c):Promise.resolve(ot()).then(e))}catch(t){return Promise.reject(t)}},exports.generateSchema=F,exports.getArrayType=W,exports.getChainHeight=ot,exports.getDictionaryTypes=z,exports.getEnvironment=d,exports.getEventName=ct,exports.getEventsInRange=st,exports.getLatestBlock=nt,exports.getPlugins=R,exports.getPragmaNotes=t=>t.match(/\/{3}\s*pragma\s*(.*)/g).reduce((t,r)=>{const e=r.match(/\/{3}\s*pragma\s+(\w*)\s+(.*)/),[,n,o]=e;return t[n]=o,t},{}),exports.getSplitCharacter=b,exports.getTemplateInfo=j,exports.mapArgument=X,exports.mapArguments=Y,exports.mapValuesToCode=Z,exports.missingImports=h,exports.mutate=pt,exports.query=dt,exports.registerPlugin=function(t){try{const{type:r}=t;return Promise.resolve(e.config().get("ix.plugins")).then(function(n){const o=n||{},c=o[r]||[];return Promise.resolve(e.config().put("ix.plugins",{...o,[r]:[...c,t]})).then(function(){})})}catch(t){return Promise.reject(t)}},exports.replaceImportAddresses=w,exports.report=g,exports.reportArguments=(t,r,e="")=>{if(r>t){const n=`Incorrect number of arguments: found ${t} of ${r}`;console.error(e?`${e} ${n}`:n)}},exports.reportMissing=(t="items",r,e,n="")=>{if(e!==r){const o=`Incorrect number of ${t}: found ${r} of ${e}`;console.error(n?`${n} ${o}`:o)}},exports.reportMissingImports=(t,r,e="")=>{const n=h(t,r);n.length>0&&g(n,e)},exports.resolveArguments=tt,exports.sendTransaction=pt,exports.setEnvironment=function(r="emulator",e={}){try{const n=r.toLowerCase();if(!u[n])throw new Error(`Provided value "${n}" is not supported. Try "emulator", "testnet" or "mainnet". Default: "emulator"`);const{port:o,endpoint:c,limit:s,extend:i}=e,a="emulator"===n&&o?`http://localhost:${o}`:l[n],d=c||a;return Promise.resolve(t.config().put("ix.env",n)).then(function(){function r(){return i&&f(i),Promise.resolve(t.config().put("accessNode.api",d)).then(function(){})}const e=function(){if(s)return Promise.resolve(t.config().put("ix.executionLimit",s)).then(function(){})}();return e&&e.then?e.then(r):r()})}catch(t){return Promise.reject(t)}},exports.splitArgs=H,exports.stripComments=$,exports.stripStrings=S,exports.trimAndSplit=(t,r,e)=>e?t.replace(r,"").split(e):t.replace(r,"").split(b(t)),exports.underscoreToCamelCase=t=>t.replace(/-/g,"_").split("_").map((t,r)=>r>0?v(t):t).join(""),exports.updateContract=function(t){try{return mt({...t,update:!0})}catch(t){return Promise.reject(t)}};
//# sourceMappingURL=main.js.map
