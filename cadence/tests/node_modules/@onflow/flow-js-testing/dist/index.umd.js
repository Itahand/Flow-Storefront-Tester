!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@onflow/fcl-config"),require("@onflow/config"),require("fs"),require("path"),require("@onflow/fcl"),require("@onflow/flow-cadut"),require("elliptic"),require("sha3"),require("rlp"),require("net")):"function"==typeof define&&define.amd?define(["exports","@onflow/fcl-config","@onflow/config","fs","path","@onflow/fcl","@onflow/flow-cadut","elliptic","sha3","rlp","net"],n):n((e||self).flowJsTesting={},e.fclConfig,e.config,e.fs,e.path,e.fcl,e.flowCadut,e.elliptic,e.sha3,e.rlp,e.net)}(this,function(e,n,t,r,o,s,c,i,a,u,l){function f(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function m(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach(function(t){if("default"!==t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}}),n.default=e,n}var g=f(r),d=f(o),p=m(s),h=m(u);const P=(e,n,t)=>{if("string"==typeof n)return P(e,n.split("/"),t);if(!n.length)return e;try{const[r,...o]=n;return P(e[r],o,t)}catch(e){return t}},v=(e,r,o,s)=>{let c=P(n.flowConfig(),o,s);c||(c=s),t.config().put(e,c)},M=e=>null==e?null:e.replace(/^0x/,""),A=e=>null==e?null:"0x"+M(e),b=new i.ec("p256"),y=(e,n)=>{const t=b.keyFromPrivate(Buffer.from(e,"hex")).sign((e=>{const n=new a.SHA3(256);return n.update(Buffer.from(e,"hex")),n.digest()})(n)),r=t.r.toArrayLike(Buffer,"be",32),o=t.s.toArrayLike(Buffer,"be",32);return Buffer.concat([r,o]).toString("hex")},w=(e,n=0)=>function(r={}){try{return Promise.resolve(t.config().get("SERVICE_ADDRESS")).then(function(o){return Promise.resolve(t.config().get("PRIVATE_KEY")).then(function(t){return e=M(e||o),{...r,tempId:`${e}-${n}`,addr:p.sansPrefix(e),keyId:n,signingFunction:function(r){try{return Promise.resolve({keyId:n,addr:A(e),signature:y(t,r.message)})}catch(e){return Promise.reject(e)}}}})})}catch(e){return Promise.reject(e)}},k=e=>"object"==typeof e&&null!==e;function T(e=1){return 0===e?Promise.resolve([]):new Promise((n,t)=>{const r=l.createServer();r.listen(0,()=>{const o=r.address().port;r.close(function(r){try{return r&&t(r),Promise.resolve(T(e-1)).then(function(e){n([...e,o])})}catch(e){return Promise.reject(e)}})})})}function x(e,n,t){if(!e.s){if(t instanceof S){if(!t.s)return void(t.o=x.bind(null,e,n));1&n&&(n=t.s),t=t.v}if(t&&t.then)return void t.then(x.bind(null,e,n),x.bind(null,e,2));e.s=n,e.v=t;const r=e.o;r&&r(e)}}const S=function(){function e(){}return e.prototype.then=function(n,t){const r=new e,o=this.s;if(o){const e=1&o?n:t;if(e){try{x(r,1,e(this.v))}catch(e){x(r,2,e)}return r}return this}return this.o=function(e){try{const o=e.v;1&e.s?x(r,1,n?n(o):o):t?x(r,1,t(o)):x(r,2,o)}catch(e){x(r,2,e)}},r},e}();function F(e,n){try{var t=e()}catch(e){return n(e)}return t&&t.then?t.then(void 0,n):t}const j=e=>function(n){try{function t(){function e(){return Promise.resolve(le()).then(function(e){function t(){return{code:r,signers:s,args:c,limit:u}}const o={...be,...n,FlowManager:e};r=Me(r,o);const i=function(e,n,t){var o=[];for(var s in e)o.push(s);return function(e,n,t){var r,o,s=-1;return function t(c){try{for(;++s<e.length;)if((c=n(s))&&c.then){if(!((i=c)instanceof S&&1&i.s))return void c.then(t,o||(o=x.bind(null,r=new S,2)));c=c.v}r?x(r,1,c):r=c}catch(e){x(r||(r=new S),2,e)}var i}(),r}(o,function(e){return function(e){return Promise.resolve((0,a[e])(r)).then(function(e){r=e})}(o[e])})}(a);return i&&i.then?i.then(t):t()})}let n;const t=function(){if(!i)return Promise.resolve(Ae(r)).then(function(e){n=e});n=be}();return t&&t.then?t.then(e):e()}let r,o,s,c,i,a,u;if(k(n[0])){const[e]=n,{name:t,code:l,args:f,signers:m,transformers:g,limit:d,service:p=!1}=e;if(i=p,!t&&!l)throw Error("Both `name` and `code` are missing. Provide either of them");o=t,r=l,s=m,c=f,a=g||[],u=d}else"script"===e?[o,c,u,a]=n:[o,s,c,u,a]=n;u=u||999;const l=function(){if(o)return Promise.resolve(("script"===e?Se:xe)({name:o})).then(function(e){r=e})}();return Promise.resolve(l&&l.then?l.then(t):t())}catch(e){return Promise.reject(e)}},I=function(){try{const e=arguments;return Promise.resolve(F(function(){const n=j("tx");return Promise.resolve(n([].slice.call(e))).then(function({code:e,args:n,signers:t,limit:r}){function o(){return Promise.resolve(p.send(i)).then(function(e){return Promise.resolve(p.tx(e).onceExecuted()).then(function(e){return[e,null]})})}const s=w(),i=[p.transaction(e),p.payer(s),p.proposer(s),p.limit(r)];if(t){const e=t.map(e=>w(e));i.push(p.authorizations(e))}else i.push(p.authorizations([s]));const a=function(){if(n)return Promise.resolve(c.resolveArguments(n,e)).then(function(e){i.push(p.args(e))})}();return a&&a.then?a.then(o):o()})},function(e){return[null,e]}))}catch(e){return Promise.reject(e)}},E=function(){try{const e=arguments;return Promise.resolve(F(function(){const n=j("script");return Promise.resolve(n([].slice.call(e))).then(function({code:e,args:n,limit:t}){function r(){return Promise.resolve(p.send(o)).then(function(e){return Promise.resolve(p.decode(e)).then(function(e){return[e,null]})})}const o=[p.script(e),p.limit(t)],s=function(){if(n)return Promise.resolve(c.resolveArguments(n,e)).then(function(e){o.push(p.args(e))})}();return s&&s.then?s.then(r):r()})},function(e){return[null,e]}))}catch(e){return Promise.reject(e)}},B="\nimport FlowManager from 0x01\n\ntransaction (_ name: String, pubKey: String, manager: Address) {\n    prepare( admin: AuthAccount) {\n        let newAccount = AuthAccount(payer:admin)\n        newAccount.addPublicKey(pubKey.decodeHex())\n\n        let linkPath = FlowManager.accountManagerPath\n        let accountManager = getAccount(manager)\n                            .getCapability(linkPath)!\n                            .borrow<&FlowManager.Mapper>()!\n        \n        // Create a record in account database\n        let address = newAccount.address\n        accountManager.setAddress(name, address: address)\n    }\n}\n\n",C=function(e={}){try{return Promise.resolve(c.getEnvironment()).then(function(n){const t={...n,...e};return c.reportMissingImports(B,t,"createAccount =>"),c.replaceImportAddresses(B,t)})}catch(e){return Promise.reject(e)}},O="\nimport FlowManager from 0x01\n\ntransaction(name:String, code: String, manager: Address ##ARGS-WITH-TYPES##) {\n    prepare(acct: AuthAccount){\n        let decoded = code.decodeHex()\n        acct.contracts.add(\n           name: name,\n           code: decoded,\n           ##ARGS-LIST##\n        )\n\n        let linkPath = FlowManager.contractManagerPath\n        let contractManager = getAccount(manager)\n                    .getCapability(linkPath)!\n                    .borrow<&FlowManager.Mapper>()!\n\n        let address = acct.address\n        contractManager.setAddress(name, address: address)\n    }\n}\n\n",R=function(e={}){try{return Promise.resolve(c.getEnvironment()).then(function(n){const t={...n,...e};return c.reportMissingImports(O,t,"deployContract =>"),c.replaceImportAddresses(O,t)})}catch(e){return Promise.reject(e)}},U='\ntransaction ( code: String ) {\n    prepare( admin: AuthAccount) {\n        admin.contracts.add(\n           name: "FlowManager",\n           code: code.decodeHex(),\n        )\n   }\n}\n\n',$=function(e={}){try{return Promise.resolve(c.getEnvironment()).then(function(n){const t={...n,...e};return c.reportMissingImports(U,t,"initManager =>"),c.replaceImportAddresses(U,t)})}catch(e){return Promise.reject(e)}},_='\nimport FungibleToken from 0xFUNGIBLETOKENADDRESS\nimport ExampleToken from 0xTOKENADDRESS\n\ntransaction(recipient: Address, amount: UFix64) {\n    let tokenAdmin: &ExampleToken.Administrator\n    let tokenReceiver: &{FungibleToken.Receiver}\n\n    prepare(signer: AuthAccount) {\n        self.tokenAdmin = signer\n        .borrow<&ExampleToken.Administrator>(from: /storage/exampleTokenAdmin)\n        ?? panic("Signer is not the token admin")\n\n        self.tokenReceiver = getAccount(recipient)\n        .getCapability(/public/exampleTokenReceiver)!\n        .borrow<&{FungibleToken.Receiver}>()\n        ?? panic("Unable to borrow receiver reference")\n    }\n\n    execute {\n        let minter <- self.tokenAdmin.createNewMinter(allowedAmount: amount)\n        let mintedVault <- minter.mintTokens(amount: amount)\n\n        self.tokenReceiver.deposit(from: <-mintedVault)\n\n        destroy minter\n    }\n}\n\n',D=function(e={}){try{return Promise.resolve(c.getEnvironment()).then(function(n){const t={...n,...e};return c.reportMissingImports(_,t,"mintTokens =>"),c.replaceImportAddresses(_,t)})}catch(e){return Promise.reject(e)}},L="\nimport FlowManager from 0x01\n\ntransaction(name: String, address: Address) {\n    prepare(signer: AuthAccount){\n        let linkPath = FlowManager.contractManagerPath\n        let contractManager = signer\n                                .getCapability(linkPath)!\n                                .borrow<&FlowManager.Mapper>()!\n        contractManager.setAddress(name, address: address)\n    }\n}\n\n",N=function(e={}){try{return Promise.resolve(c.getEnvironment()).then(function(n){const t={...n,...e};return c.reportMissingImports(L,t,"registerContract =>"),c.replaceImportAddresses(L,t)})}catch(e){return Promise.reject(e)}},H="\ntransaction{\n    prepare(acct: AuthAccount){\n        log(acct.address)\n    }\n}\n",q=function(e={}){try{return Promise.resolve(c.getEnvironment()).then(function(n){const t={...n,...e};return c.reportMissingImports(H,t,"scratch =>"),c.replaceImportAddresses(H,t)})}catch(e){return Promise.reject(e)}},V="\nimport FlowManager from 0x01\n\ntransaction(offset: UInt64){\n    prepare(signer:AuthAccount){\n        FlowManager.setBlockOffset(offset)\n    }\n}\n\n",G=function(e={}){try{return Promise.resolve(c.getEnvironment()).then(function(n){const t={...n,...e};return c.reportMissingImports(V,t,"setBlockOffset =>"),c.replaceImportAddresses(V,t)})}catch(e){return Promise.reject(e)}},K="\nimport FlowManager from 0x01\n\ntransaction(offset: UFix64){\n    prepare(signer:AuthAccount){\n        FlowManager.setTimestampOffset(offset)\n    }\n}\n\n",z=function(e={}){try{return Promise.resolve(c.getEnvironment()).then(function(n){const t={...n,...e};return c.reportMissingImports(K,t,"setTimestampOffset =>"),c.replaceImportAddresses(K,t)})}catch(e){return Promise.reject(e)}},Y="\nimport FlowManager from 0x01\n\ntransaction(name:String, code: String, manager: Address ##ARGS-WITH-TYPES##) {\n    prepare(acct: AuthAccount){\n        let decoded = code.decodeHex()\n\n        if acct.contracts.get(name: name) == nil {\n          acct.contracts.add(name: name, code: decoded)\n        } else {\n          acct.contracts.update__experimental(name: name, code: decoded)\n        }\n\n        let linkPath = FlowManager.contractManagerPath\n        let contractManager = getAccount(manager)\n                    .getCapability(linkPath)!\n                    .borrow<&FlowManager.Mapper>()!\n\n        let address = acct.address\n        contractManager.setAddress(name, address: address)\n    }\n}\n\n",J=function(e={}){try{return Promise.resolve(c.getEnvironment()).then(function(n){const t={...n,...e};return c.reportMissingImports(Y,t,"updateContract =>"),c.replaceImportAddresses(Y,t)})}catch(e){return Promise.reject(e)}};var W={createAccountTemplate:C,createAccount:function(e={}){try{const{addressMap:n,args:t=[],signers:r=[]}=e;return Promise.resolve(C(n)).then(function(n){return c.reportMissing("arguments",t.length,3,"createAccount =>"),c.reportMissing("signers",r.length,1,"createAccount =>"),c.sendTransaction({code:n,processed:!0,...e})})}catch(e){return Promise.reject(e)}},deployContractTemplate:R,deployContract:function(e={}){try{const{addressMap:n,args:t=[],signers:r=[]}=e;return Promise.resolve(R(n)).then(function(n){return c.reportMissing("arguments",t.length,3,"deployContract =>"),c.reportMissing("signers",r.length,1,"deployContract =>"),c.sendTransaction({code:n,processed:!0,...e})})}catch(e){return Promise.reject(e)}},initManagerTemplate:$,initManager:function(e={}){try{const{addressMap:n,args:t=[],signers:r=[]}=e;return Promise.resolve($(n)).then(function(n){return c.reportMissing("arguments",t.length,1,"initManager =>"),c.reportMissing("signers",r.length,1,"initManager =>"),c.sendTransaction({code:n,processed:!0,...e})})}catch(e){return Promise.reject(e)}},mintTokensTemplate:D,mintTokens:function(e={}){try{const{addressMap:n,args:t=[],signers:r=[]}=e;return Promise.resolve(D(n)).then(function(n){return c.reportMissing("arguments",t.length,2,"mintTokens =>"),c.reportMissing("signers",r.length,1,"mintTokens =>"),c.sendTransaction({code:n,processed:!0,...e})})}catch(e){return Promise.reject(e)}},registerContractTemplate:N,registerContract:function(e={}){try{const{addressMap:n,args:t=[],signers:r=[]}=e;return Promise.resolve(N(n)).then(function(n){return c.reportMissing("arguments",t.length,2,"registerContract =>"),c.reportMissing("signers",r.length,1,"registerContract =>"),c.sendTransaction({code:n,processed:!0,...e})})}catch(e){return Promise.reject(e)}},scratchTemplate:q,scratch:function(e={}){try{const{addressMap:n,args:t=[],signers:r=[]}=e;return Promise.resolve(q(n)).then(function(n){return c.reportMissing("arguments",t.length,0,"scratch =>"),c.reportMissing("signers",r.length,1,"scratch =>"),c.sendTransaction({code:n,processed:!0,...e})})}catch(e){return Promise.reject(e)}},setBlockOffsetTemplate:G,setBlockOffset:function(e={}){try{const{addressMap:n,args:t=[],signers:r=[]}=e;return Promise.resolve(G(n)).then(function(n){return c.reportMissing("arguments",t.length,1,"setBlockOffset =>"),c.reportMissing("signers",r.length,1,"setBlockOffset =>"),c.sendTransaction({code:n,processed:!0,...e})})}catch(e){return Promise.reject(e)}},setTimestampOffsetTemplate:z,setTimestampOffset:function(e={}){try{const{addressMap:n,args:t=[],signers:r=[]}=e;return Promise.resolve(z(n)).then(function(n){return c.reportMissing("arguments",t.length,1,"setTimestampOffset =>"),c.reportMissing("signers",r.length,1,"setTimestampOffset =>"),c.sendTransaction({code:n,processed:!0,...e})})}catch(e){return Promise.reject(e)}},updateContractTemplate:J,updateContract:function(e={}){try{const{addressMap:n,args:t=[],signers:r=[]}=e;return Promise.resolve(J(n)).then(function(n){return c.reportMissing("arguments",t.length,3,"updateContract =>"),c.reportMissing("signers",r.length,1,"updateContract =>"),c.sendTransaction({code:n,processed:!0,...e})})}catch(e){return Promise.reject(e)}}};const{updateContractTemplate:Q,deployContractTemplate:X}=W,Z=e=>Buffer.from(e,"utf8").toString("hex"),ee=function(e){try{let n,t,r,o,s;if(k(e[0])){const[c]=e,{name:i,to:a,addressMap:u,args:l,update:f}=c;if(!i)throw Error("'name' field is missing");n=i,t=a,o=l,r=u,s=f}else[n,t,r,o,s]=e;return Promise.resolve(le()).then(function(e){const c={...be,FlowManager:e,...r};return{name:n,to:t,args:o,update:s,addressMap:c}})}catch(e){return Promise.reject(e)}},ne=function(e){try{const{to:n,code:t,name:r,args:o,update:s}=e;return Promise.resolve(c.extractContractParameters(t)).then(function(e){function i(n){return Promise.resolve(le()).then(function(r){return Promise.resolve(Ae(t)).then(function(i){return Promise.resolve(le()).then(function(u){const l={...be,...i,FlowManager:u},f=Z(Me(t,l));return Promise.resolve(s?Q(l):X(l)).then(function(t){let s=[a,f,r];if(o){s=s.concat(o);const n=c.generateSchema(e.args).map(e=>c.splitArgs(e)[0]),r="abcdefghijklmnopqrstuvwxyz";let i=[];for(let e=0;e<n.length;e++)i.push(`${r[e]}: ${n[e]}`);t=(t=t.replace("##ARGS-WITH-TYPES##",`, ${e.args}`)).replace("##ARGS-LIST##",i)}else t=(t=t.replace("##ARGS-WITH-TYPES##","")).replace("##ARGS-LIST##","");return I({code:t,args:s,signers:[n]})})})})})}const a=r||e.contractName;return n?i(n):Promise.resolve(le()).then(i)})}catch(e){return Promise.reject(e)}},te='\npub contract FlowManager {\n\n    /// Account Manager\n    pub event AccountAdded(address: Address)\n\n    pub struct Mapper {\n        pub let accounts: {String: Address}\n\n        pub fun getAddress(_ name: String): Address? {\n            return self.accounts[name]\n        }\n\n        pub fun setAddress(_ name: String, address: Address){\n            self.accounts[name] = address\n            emit FlowManager.AccountAdded(address: address)\n        }\n\n        init(){\n            self.accounts = {}\n        }\n    }\n\n    pub fun getAccountAddress(_ name: String): Address?{\n        let accountManager = self.account\n            .getCapability(self.accountManagerPath)\n            .borrow<&FlowManager.Mapper>()!\n\n        return accountManager.getAddress(name)\n    }\n\n    pub let defaultAccounts: {Address : String}\n\n    pub fun resolveDefaultAccounts(_ address: Address): Address{\n        let alias = self.defaultAccounts[address]!\n        return self.getAccountAddress(alias)!\n    }\n\n    pub let accountManagerStorage: StoragePath\n    pub let contractManagerStorage: StoragePath\n    pub let accountManagerPath: PublicPath\n    pub let contractManagerPath: PublicPath\n\n    /// Environment Manager\n    pub event BlockOffsetChanged(offset: UInt64)\n    pub event TimestampOffsetChanged(offset: UFix64)\n\n    pub struct MockBlock {\n        pub let id: [UInt8; 32]\n        pub let height: UInt64\n        pub let view: UInt64\n        pub let timestamp: UFix64\n\n        init(_ id: [UInt8; 32], _ height: UInt64, _ view: UInt64, _ timestamp: UFix64){\n            self.id = id\n            self.height = height\n            self.view = view\n            self.timestamp = timestamp\n        }\n    }\n\n    pub fun setBlockOffset(_ offset: UInt64){\n        self.blockOffset = offset\n        emit FlowManager.BlockOffsetChanged(offset: offset)\n    }\n\n    pub fun setTimestampOffset(_ offset: UFix64){\n        self.timestampOffset = offset\n        emit FlowManager.TimestampOffsetChanged(offset: offset)\n    }\n\n    pub fun getBlockHeight(): UInt64 {\n        var block = getCurrentBlock()\n        return block.height + self.blockOffset\n    }\n\n    pub fun getBlockTimestamp(): UFix64 {\n        var block = getCurrentBlock()\n        return block.timestamp + self.timestampOffset\n    }\n\n    pub fun getBlock(): MockBlock {\n        var block =  getCurrentBlock()\n        let mockBlock = MockBlock(block.id, block.height, block.view, block.timestamp);\n        return mockBlock\n    }\n\n    pub var blockOffset: UInt64;\n    pub var timestampOffset: UFix64;\n\n\n    // Initialize contract\n    init(){\n        // Environment defaults\n        self.blockOffset = 0;\n        self.timestampOffset = 0.0;\n\n        // Account Manager initialization\n        let accountManager = Mapper()\n        let contractManager = Mapper()\n\n        self.defaultAccounts = {\n          0x01: "Alice",\n          0x02: "Bob",\n          0x03: "Charlie",\n          0x04: "Dave",\n          0x05: "Eve"\n        }\n\n        self.accountManagerStorage = /storage/testSuiteAccountManager\n        self.contractManagerStorage = /storage/testSuiteContractManager\n\n        self.accountManagerPath = /public/testSuiteAccountManager\n        self.contractManagerPath = /public/testSuiteContractManager\n        \n        // Destroy previously stored values\n        self.account.load<Mapper>(from: self.accountManagerStorage)\n        self.account.load<Mapper>(from: self.contractManagerStorage)\n\n        self.account.save(accountManager, to: self.accountManagerStorage)\n        self.account.save(contractManager, to: self.contractManagerStorage)\n\n        self.account.link<&Mapper>(self.accountManagerPath, target: self.accountManagerStorage)\n        self.account.link<&Mapper>(self.contractManagerPath, target: self.contractManagerStorage)\n    }\n}\n \n',re="\nimport FlowManager from 0x01\n\npub fun main(){\n    // the body can be empty, cause script will throw error if FlowManager is not\n    // added to service address\n}\n\n",oe="\nimport FlowManager from 0x01\n\npub fun main(name: String, managerAccount: Address):Address? {\n    let manager = getAccount(managerAccount)\n    let linkPath = FlowManager.accountManagerPath\n    let accountManager = manager\n                        .getCapability(linkPath)\n                        .borrow<&FlowManager.Mapper>()!\n\n    return accountManager.getAddress(name)\n\n}\n",se='\n// This script reads the balance field of an account\'s FlowToken Balance\n\nimport FungibleToken from 0xFUNGIBLETOKENADDRESS\nimport ExampleToken from 0xTOKENADDRESS\n\npub fun main(account: Address): UFix64 {\n    let acct = getAccount(account)\n    let vaultRef = acct.getCapability(/public/exampleTokenBalance)!.borrow<&ExampleToken.Vault{FungibleToken.Balance}>()\n        ?? panic("Could not borrow Balance reference to the Vault")\n\n    return vaultRef.balance\n}\n',ce="\nimport FlowManager from 0x01\n\npub fun main():UInt64 {\n    return FlowManager.blockOffset\n}\n\n",ie="\nimport FlowManager from 0x01\n\npub fun main(name: String, managerAccount: Address):Address? {\n    let manager = getAccount(managerAccount)\n    let linkPath = FlowManager.contractManagerPath\n    let contractManager = manager\n                        .getCapability(linkPath)\n                        .borrow<&FlowManager.Mapper>()!\n\n    return contractManager.getAddress(name)\n\n}\n",ae="\nimport FlowManager from 0x01\n\npub fun main():UFix64 {\n    return FlowManager.timestampOffset\n}\n\n";var ue=W;const le=function(){try{return Promise.resolve(t.config().get("SERVICE_ADDRESS")).then(A)}catch(e){return Promise.reject(e)}},fe=function(){try{return Promise.resolve(le()).then(function(e){return Promise.resolve(function(e={}){try{return Promise.resolve(c.getEnvironment()).then(function(n){const t={...n,...e};return c.reportMissingImports(re,t,"checkManager =>"),c.replaceImportAddresses(re,t)})}catch(e){return Promise.reject(e)}}({FlowManager:e})).then(function(e){return Promise.resolve(E({code:e,service:!0})).then(function([e,n]){const t=function(){if(n&&null===e)return Promise.resolve(function(){try{return Promise.resolve(ue.initManagerTemplate()).then(function(e){return Promise.resolve(function(e={}){try{return Promise.resolve(c.getEnvironment()).then(function(n){const t={...n,...e};return c.reportMissingImports(te,t,"FlowManager =>"),c.replaceImportAddresses(te,t)})}catch(e){return Promise.reject(e)}}()).then(function(n){const t=Z(n);return Promise.resolve(I({code:e,args:[t],service:!0})).then(function(){})})})}catch(e){return Promise.reject(e)}}()).then(function(){})}();return t&&t.then?t.then(function(){return le()}):le()})})})}catch(e){return Promise.reject(e)}},me=function(e,n=!1){try{if(n){const n=be[e];if(void 0!==n)return Promise.resolve(n)}return Promise.resolve(fe()).then(function(n){return Promise.resolve(function(e={}){try{return Promise.resolve(c.getEnvironment()).then(function(n){const t={...n,...e};return c.reportMissingImports(ie,t,"getContractAddress =>"),c.replaceImportAddresses(ie,t)})}catch(e){return Promise.reject(e)}}({FlowManager:n})).then(function(t){return Promise.resolve(E({code:t,args:[e,n],service:!0})).then(function([e]){return e})})})}catch(e){return Promise.reject(e)}};function ge(e,n,t){if(!e.s){if(t instanceof pe){if(!t.s)return void(t.o=ge.bind(null,e,n));1&n&&(n=t.s),t=t.v}if(t&&t.then)return void t.then(ge.bind(null,e,n),ge.bind(null,e,2));e.s=n,e.v=t;const r=e.o;r&&r(e)}}const de=/(\s*import\s*)([\w\d]+)(\s+from\s*)([\w\d".\\/]+)/g,pe=function(){function e(){}return e.prototype.then=function(n,t){const r=new e,o=this.s;if(o){const e=1&o?n:t;if(e){try{ge(r,1,e(this.v))}catch(e){ge(r,2,e)}return r}return this}return this.o=function(e){try{const o=e.v;1&e.s?ge(r,1,n?n(o):o):t?ge(r,1,t(o)):ge(r,2,o)}catch(e){ge(r,2,e)}},r},e}(),he=e=>e.split(/\s/).map(e=>e.replace(/\s/g,"")).filter(e=>e.length>0&&"import"!==e&&"from"!==e),Pe=(e,n)=>{const[t,r]=n;return e[t]=r,e},ve=e=>e&&0!==e.length?e.split("\n").filter(e=>e.includes("import")).map(he).reduce(Pe,{}):{},Me=(e,n,t=!0)=>e.replace(de,(e,r,o,s,c)=>{const i=t?o:c;return`${r}${o} from ${n instanceof Function?n(i):n[i]}`}),Ae=function(e){try{const n={},t=function(e,t,r){var o=[];for(var s in e)o.push(s);return function(e,n,t){var r,o,s=-1;return function t(c){try{for(;++s<e.length;)if((c=n(s))&&c.then){if(!((i=c)instanceof pe&&1&i.s))return void c.then(t,o||(o=ge.bind(null,r=new pe,2)));c=c.v}r?ge(r,1,c):r=c}catch(e){ge(r||(r=new pe),2,e)}var i}(),r}(o,function(e){return function(e){const t=function(){if(!be[e])return Promise.resolve(me(e)).then(function(t){n[e]=t});n[e]=be[e]}();if(t&&t.then)return t.then(function(){})}(o[e])})}(ve(e));return Promise.resolve(t&&t.then?t.then(function(){return n}):n)}catch(e){return Promise.reject(e)}},be={FlowToken:"0x0ae53cb6e3f42a79",FungibleToken:"0xee82856bf20e2aa6",FlowFees:"0xe5a8b7f23e8b548f",FlowStorageFees:"0xf8d6e0586b0a20c7"},ye={"0xe5a8b7f23e8b548f":"0xe5a8b7f23e8b548f","0xf8d6e0586b0a20c7":"0xf8d6e0586b0a20c7","0x0ae53cb6e3f42a79":"0x0ae53cb6e3f42a79","0xee82856bf20e2aa6":"0xee82856bf20e2aa6"},we=function(e,n="transactions"){try{return Promise.resolve(t.config().get("BASE_PATH")).then(function(t){let r=t;if(k(t)){const o=t[n];if(o)return d.default.resolve(o,`./${e}.cdc`);r=t.base}return d.default.resolve(r,`./${n}/${e}.cdc`)})}catch(e){return Promise.reject(e)}},ke=(e,n={},t=!1)=>{const r=(e=>g.default.readFileSync(e,"utf8"))(e);return n?Me(r,{...t?ye:be,...n}):r},Te=function({name:e,addressMap:n}){try{return Promise.resolve(we(e,"contracts")).then(function(e){return ke(e,n)})}catch(e){return Promise.reject(e)}},xe=function({name:e,addressMap:n}){try{return Promise.resolve(we(e,"transactions")).then(function(e){return ke(e,n)})}catch(e){return Promise.reject(e)}},Se=function({name:e,addressMap:n}){try{return Promise.resolve(we(e,"scripts")).then(function(e){return ke(e,n)})}catch(e){return Promise.reject(e)}},Fe={ExampleToken:be.FlowToken},je=e=>e[0].toLowerCase()+e.slice(1),{expect:Ie}=global,Ee=function(e){try{let t;function n(n){return t?n:Promise.resolve(e)}const r=function(){if("function"==typeof e)return t=1,Promise.resolve(e())}();return Promise.resolve(r&&r.then?r.then(n):n(r))}catch(e){return Promise.reject(e)}},{spawn:Be}=require("child_process"),Ce={log:console.log,service:console.log,info:console.log,error:console.error,warn:console.warn};var Oe=new class{constructor(){this.initialized=!1,this.logging=!1,this.filters=[],this.logProcessor=e=>e}setLogging(e){this.logging=e}log(e,n="log"){!1!==this.logging&&Ce[n](e)}checkLevel(e,n){return"debug"===n&&e.includes("LOG")?"log":n}extractKeyValue(e){const[n,t]=e.split("=");return t.includes("LOG")?{key:n,value:t.replace('"[1;34m','"[1[34m')}:{key:n,value:t}}fixJSON(e){const n=e.split("\n").filter(e=>""!==e);return n.length>1?`[${n.join(",")}]`:n[0]}parseDataBuffer(e){const n=e.toString();try{if(n.includes("msg"))return JSON.parse(this.fixJSON(n))}catch(e){return console.error(e),{msg:e,level:"JSON Error"}}return{msg:n,level:"parser"}}start(e={}){try{const n=this,r=arguments;return Promise.resolve(T(3)).then(function(o){[n.grpcPort,n.restPort,n.adminPort]=o,n.grpcPort=e.grpcPort||n.grpcPort,n.restPort=e.restPort||n.restPort,n.adminPort=e.adminPort||n.adminPort,(r.length>1||"number"==typeof r[0])&&(console.warn("Calling emulator.start with the port argument is now deprecated in favour of dynamically selected ports and will be removed in future versions of flow-js-testing.\nPlease refrain from supplying this argument, as using it may cause unintended consequences.\nMore info: https://github.com/onflow/flow-js-testing/blob/master/TRANSITIONS.md#001-deprecate-emulatorstart-port-argument"),[n.adminPort,e={}]=r,n.grpcPort=n.adminPort-8080+3569);const{flags:c="",logging:i=!1}=e;return t.config().put("accessNode.api",`http://localhost:${n.restPort}`),n.logging=i,n.process=Be("flow",["emulator","--verbose","--log-format=JSON",`--rest-port=${n.restPort}`,`--admin-port=${n.adminPort}`,`--port=${n.grpcPort}`,c]),n.logProcessor=e=>e,Promise.resolve(t.config().put("logger.level",0)).then(function(){return new Promise((e,r)=>{let o;o=setInterval(function(){try{const n=this,r=function(r,c){try{var i=Promise.resolve(s.send(s.build([s.getBlock(!1)])).then(s.decode)).then(function(){return clearInterval(o),Promise.resolve(t.config().put("logger.level",2)).then(function(){n.initialized=!0,e(!0)})})}catch(e){return}return i&&i.then?i.then(void 0,function(){}):i}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},100),n.process.stdout.on("data",e=>{const t=n.parseDataBuffer(e);if(Array.isArray(t)){let e=[];n.filters.length>0&&(e=t.filter(e=>{const t=n.checkLevel(e.msg,e.level);return n.filters.includes(t)}));for(let r=0;r<e.length;r++){const e=t[r],{msg:o}=e,s=n.checkLevel(o,e.level);n.log(`${s.toUpperCase()}: ${o}`)}}else{const{msg:e}=t,r=n.checkLevel(e,t.level);n.filters.length>0?n.filters.includes(r)&&(n.log(`${r.toUpperCase()}: ${e}`),e.includes("Starting")&&e.includes(n.adminPort)&&n.log("EMULATOR IS UP! Listening for events!")):(n.log(`${r.toUpperCase()}: ${e}`),t.msg.includes("Starting HTTP server")&&n.log("EMULATOR IS UP! Listening for events!"))}}),n.process.stderr.on("data",e=>{const{message:t}=n.parseDataBuffer(e);n.log(`EMULATOR ERROR: ${t}`,"error"),n.initialized=!1,clearInterval(o),r()}),n.process.on("close",t=>{n.filters.includes("service")&&n.log(`EMULATOR: process exited with code ${t}`),n.initialized=!1,clearInterval(o),e(!1)})})})})}catch(e){return Promise.reject(e)}}clearFilters(){this.filters=[]}removeFilter(e){this.filters=this.filters.filter(n=>n!==e)}addFilter(e){this.filters.includes(e)||this.filters.push(e)}stop(){try{const e=this;return Promise.resolve(new Promise(n=>{e.process.kill(),setTimeout(()=>{e.initialized=!1,n(!1)},50)}))}catch(e){return Promise.reject(e)}}};e.builtInMethods=function(e){try{function n(){return t.replace(/getCurrentBlock\(\).height/g,"FlowManager.getBlockHeight()").replace(/getCurrentBlock\(\).timestamp/g,"FlowManager.getBlockTimestamp()")}let t=e;const r=function(){if(!((e,n)=>new RegExp("import\\s+FlowManager").test(n))(0,e))return Promise.resolve(function(){try{return Promise.resolve(le()).then(function(e){return`import FlowManager from ${e}`})}catch(e){return Promise.reject(e)}}()).then(function(n){t=`\n      ${n}\n      ${e}  \n  `})}();return Promise.resolve(r&&r.then?r.then(n):n())}catch(e){return Promise.reject(e)}},e.deployContract=ne,e.deployContractByName=function(){try{return Promise.resolve(ee([].slice.call(arguments))).then(function(e){function n(e){return Promise.resolve(Te({name:r,addressMap:o})).then(function(n){const t=/[\\/]/.test(r)?null:r;return ne({to:e,code:n,name:t,args:s,update:c})})}const{to:t,name:r,addressMap:o,args:s,update:c=!1}=e;return t?n(t):Promise.resolve(le()).then(n)})}catch(e){return Promise.reject(e)}},e.emulator=Oe,e.executeScript=E,e.extractImports=ve,e.getAccountAddress=function(e){try{const n=e||`deployment-account-${(Math.random()*Math.pow(10,8)).toFixed(0)}`;return Promise.resolve(fe()).then(function(e){const r={FlowManager:e};let o;return Promise.resolve(function(e={}){try{return Promise.resolve(c.getEnvironment()).then(function(n){const t={...n,...e};return c.reportMissingImports(oe,t,"getAccountAddress =>"),c.replaceImportAddresses(oe,t)})}catch(e){return Promise.reject(e)}}(r)).then(function(s){return Promise.resolve(E({code:s,args:[n,e],service:!0})).then(function([s]){o=s;const c=function(){if(null===o)return Promise.resolve(ue.createAccountTemplate(r)).then(function(r){return Promise.resolve(function(){try{const e=b.keyFromPrivate,n=Buffer,r=n.from;return Promise.resolve(t.config().get("PRIVATE_KEY")).then(function(t){const o=e.call(b,r.call(n,t,"hex")).getPublic("hex").replace(/^04/,"");return h.encode([Buffer.from(o,"hex"),2,3,1e3]).toString("hex")})}catch(e){return Promise.reject(e)}}()).then(function(t){return Promise.resolve(I({code:r,args:[n,t,e]})).then(function([e]){const{events:n}=e,t=n.find(e=>e.type.includes("AccountAdded"));o=t.data.address})})})}();return c&&c.then?c.then(function(){return o}):o})})})}catch(e){return Promise.reject(e)}},e.getBlockOffset=function(){try{return Promise.resolve(fe()).then(function(e){return Promise.resolve(function(e={}){try{return Promise.resolve(c.getEnvironment()).then(function(n){const t={...n,...e};return c.reportMissingImports(ce,t,"getBlockOffset =>"),c.replaceImportAddresses(ce,t)})}catch(e){return Promise.reject(e)}}({FlowManager:e})).then(function(e){return E({code:e})})})}catch(e){return Promise.reject(e)}},e.getConfigValue=function(e){try{return Promise.resolve(t.config().get(e))}catch(e){return Promise.reject(e)}},e.getContractAddress=me,e.getContractCode=Te,e.getFlowBalance=function(e){try{return Promise.resolve(function(e){try{return Promise.resolve(function(e={}){try{return Promise.resolve(c.getEnvironment()).then(function(n){const t={...n,...e};return c.reportMissingImports(se,t,"getBalance =>"),c.replaceImportAddresses(se,t)})}catch(e){return Promise.reject(e)}}(Fe)).then(function(n){return n.replace(/(ExampleToken)/gi,n=>"ExampleToken"===n?e:je(e))})}catch(e){return Promise.reject(e)}}("FlowToken")).then(function(n){const t=Me(n,be);return E({code:t,args:[e]})})}catch(e){return Promise.reject(e)}},e.getScriptCode=Se,e.getServiceAddress=le,e.getTemplate=ke,e.getTimestampOffset=function(){try{return Promise.resolve(fe()).then(function(e){return Promise.resolve(function(e={}){try{return Promise.resolve(c.getEnvironment()).then(function(n){const t={...n,...e};return c.reportMissingImports(ae,t,"getTimestampOffset =>"),c.replaceImportAddresses(ae,t)})}catch(e){return Promise.reject(e)}}({FlowManager:e})).then(function(e){return E({code:e})})})}catch(e){return Promise.reject(e)}},e.getTransactionCode=xe,e.init=function(e,n={}){try{const{pkey:t="48a1f554aeebf6bf9fe0d7b5b79d080700b073ee77909973ea0b2f6fbc902"}=n;return v("PRIVATE_KEY",process,"accounts/emulator-account/key",t),v("SERVICE_ADDRESS",process,"accounts/emulator-account/address","f8d6e0586b0a20c7"),v("BASE_PATH",process,"testing/paths",e),Promise.resolve()}catch(e){return Promise.reject(e)}},e.mintFlow=function(e,n){try{return Promise.resolve(function(e){try{return Promise.resolve(ue.mintTokensTemplate(Fe)).then(function(n){return n.replace(/(ExampleToken)/gi,n=>"ExampleToken"===n?e:je(e))})}catch(e){return Promise.reject(e)}}("FlowToken")).then(function(t){const r=Me(t,be);return I({code:r,args:[e,n]})})}catch(e){return Promise.reject(e)}},e.promise=Ee,e.replaceImportAddresses=Me,e.resolveImports=Ae,e.sendTransaction=I,e.set=v,e.setBlockOffset=function(e){try{return Promise.resolve(fe()).then(function(n){const t=[e];return Promise.resolve(ue.setBlockOffsetTemplate({FlowManager:n})).then(function(e){return I({code:e,args:t,payer:[n]})})})}catch(e){return Promise.reject(e)}},e.setTimestampOffset=function(e){try{return Promise.resolve(fe()).then(function(n){const t=[e];return Promise.resolve(ue.setTimestampOffsetTemplate({FlowManager:n})).then(function(e){return I({code:e,args:t,payer:[n]})})})}catch(e){return Promise.reject(e)}},e.shallPass=function(e){try{const n=Ee(e);return Promise.resolve(n).then(function(e){const[n,t]=e;if(t)throw t;let r,o;if(Array.isArray(n)){const{status:e,errorMessage:t}=n;r=e,o=t}else{const{status:e,errorMessage:t}=n;r=e,o=t}return Promise.resolve(Ie(r).toBe(4)).then(function(){return Promise.resolve(Ie(o).toBe("")).then(function(){return e})})})}catch(e){return Promise.reject(e)}},e.shallResolve=function(e){try{const n=Ee(e);return Promise.resolve(n).then(function(e){const[,n]=e;return Ie(n).toBe(null),e})}catch(e){return Promise.reject(e)}},e.shallRevert=function(e,n){try{const t=Ee(e);return Promise.resolve(t).then(function(e){const[t,r]=e;return Promise.resolve(Ie(t).toBe(null)).then(function(){const t=function(){if(!n)return Promise.resolve(Ie(r).not.toBe(null)).then(function(){});{var e;const t=null==(e=r.toString().match(/^error: (panic)|(assertion failed): ([^\r\n]*)$/m))?void 0:e.at(3),o=n instanceof RegExp?Promise.resolve(Ie(t).toMatch(n)).then(function(){}):Promise.resolve(Ie(t).toBe(n)).then(function(){});if(o&&o.then)return o.then(function(){})}}();return t&&t.then?t.then(function(){return e}):e})})}catch(e){return Promise.reject(e)}},e.shallThrow=function(e){try{const n=Ee(e);return Promise.resolve(n).then(function(e){const[n,t]=e;return Promise.resolve(Ie(n).toBe(null)).then(function(){return Promise.resolve(Ie(t).not.toBe(null)).then(function(){return e})})})}catch(e){return Promise.reject(e)}}});
//# sourceMappingURL=index.umd.js.map
